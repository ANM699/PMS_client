(this.webpackJsonppms=this.webpackJsonppms||[]).push([[7],{385:function(e,t,a){"use strict";var n=a(0),r=a.n(n),c=a(386),o=a.n(c);function l(e,t){for(var a=[],n=0;n<e;n++){var c=r.a.createElement("div",{key:n,className:"".concat(o.a.block," ").concat(t)});a.push(c)}return a}t.a=function(e){return r.a.createElement("div",{className:o.a.container},l(e.todo,o.a.todo),l(e.doing,o.a.doing),l(e.done,o.a.done))}},386:function(e,t,a){e.exports={container:"_3U1Y55kCNk9Nf0cyrnE5dA",block:"_3EpNt1oR5bU4tQbOC3wv-q",todo:"_12kVQ7M2l2de7nC5Zjgp0M",doing:"_3A8b2Ti3cGKbsJeL7IEAM",done:"SvILxQULxCn3hY2IlpBFW"}},394:function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return r}));a(28);function n(e){var t={todo:[],doing:[],done:[]};return Array.isArray(e)&&e.forEach((function(e){t[e.status].push(e)})),t}var r={todo:{color:"#4a9ff9",display:"\u672a\u5f00\u59cb"},doing:{color:"#f9944a",display:"\u8fdb\u884c\u4e2d"},done:{color:"#2ac06d",display:"\u5df2\u5b8c\u6210"}}},395:function(e,t,a){"use strict";a.d(t,"a",(function(){return w}));var n=a(7),r=a(2),c=a(31),o=a(0),l=a.n(o),i=a(666),u=a(660),s=a(347),d=a(109),f=a(350),m=a(677),b=i.a.Column;function p(e){var t=e.data,a=e.status,n=e.size,r=void 0===n?"default":n,c=e.onItemEditClick,o=e.editable,p=void 0===o||o;return l.a.createElement(i.a,{dataSource:t,pagination:!1,rowKey:"_id",size:r},l.a.createElement(b,{width:"90px",title:"\u72b6\u6001",dataIndex:"status",key:"status",render:function(e){var t=a[e];return l.a.createElement(u.a,{color:t.color},t.display)}}),l.a.createElement(b,{title:"\u5185\u5bb9",dataIndex:"content",key:"content"}),l.a.createElement(b,{title:"\u53c2\u4e0e\u8005",dataIndex:"users",key:"users",render:function(e){return l.a.createElement(s.a.Group,null,e.map((function(e){return l.a.createElement(d.a,{key:e._id,title:e.username,placement:"top"},l.a.createElement(s.a,{style:{backgroundColor:e.avatar},icon:l.a.createElement(f.a,null)}))})))}}),l.a.createElement(b,{title:"\u521b\u5efa\u65e5\u671f",dataIndex:"createDate"}),l.a.createElement(b,{title:"\u5f00\u59cb\u65e5\u671f",dataIndex:"startDate"}),l.a.createElement(b,{title:"\u5b8c\u6210\u65e5\u671f",dataIndex:"endDate"}),p?l.a.createElement(b,{title:"\u64cd\u4f5c",dataIndex:"_id",key:"action",render:function(e,t){return l.a.createElement("a",{onClick:function(e){e.preventDefault(),c(t)}},l.a.createElement(m.a,null))}}):null)}var E=a(490),v=a(345),O=a(346),j=a(349),k=a(492),g=a(665),D=a(190),h=a.n(D),y=E.a.Option;function x(e){var t=e.visible,a=e.onOk,n=e.onCancel,i=e.task,u=e.users,d=Object(o.useState)(),m=Object(c.a)(d,2),b=m[0],p=m[1],D=v.a.useForm(),x=Object(c.a)(D,1)[0];return Object(o.useEffect)((function(){if(i){p(i.status);var e=i.startDate?h()(i.startDate):h()(),t=i.endDate?h()(i.endDate):h()(),a=i.users.map((function(e){return e._id}));x.setFieldsValue(Object(r.a)(Object(r.a)({},i),{},{selectedUsers:a,startDate:e,endDate:t}))}else x.resetFields()}),[i]),l.a.createElement(O.a,{forceRender:!0,title:"\u7f16\u8f91\u4efb\u52a1",width:640,visible:t,onOk:function(){x.validateFields().then((function(e){a(e)})).catch((function(e){console.log("\u9a8c\u8bc1\u5931\u8d25\uff1a",e)}))},onCancel:n,okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88"},l.a.createElement(v.a,{form:x,labelCol:{span:5},wrapperCol:{span:16}},l.a.createElement(v.a.Item,{name:"selectedUsers",label:"\u53c2\u4e0e\u8005",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u53c2\u4e0e\u8005\uff01"}]},l.a.createElement(E.a,{showSearch:!0,placeholder:"\u9009\u62e9\u53c2\u4e0e\u8005",optionFilterProp:"title",optionLabelProp:"title",mode:"multiple"},u.map((function(e,t){return l.a.createElement(y,{key:t,value:e._id,title:e.username},l.a.createElement(j.b,null,l.a.createElement(s.a,{style:{backgroundColor:e.avatar},icon:l.a.createElement(f.a,null)}),l.a.createElement("div",null,l.a.createElement("a",null," ",e.username),l.a.createElement("div",{style:{color:"rgba(0,0,0,.45)"}},e.email))))})))),l.a.createElement(v.a.Item,{name:"status",label:"\u72b6\u6001"},l.a.createElement(k.a.Group,{name:"radiogroup",onChange:function(e){p(e.target.value)}},l.a.createElement(k.a,{value:"todo"},"\u672a\u5f00\u59cb"),l.a.createElement(k.a,{value:"doing"},"\u8fdb\u884c\u4e2d"),l.a.createElement(k.a,{value:"done"},"\u5df2\u5b8c\u6210"))),"todo"!==b?l.a.createElement(v.a.Item,{name:"startDate",label:"\u5f00\u59cb\u65e5\u671f",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u5f00\u59cb\u65e5\u671f\uff01"}]},l.a.createElement(g.a,null)):null,"done"===b?l.a.createElement(v.a.Item,{name:"endDate",label:"\u5b8c\u6210\u65e5\u671f",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u5b8c\u6210\u65e5\u671f\uff01"}]},l.a.createElement(g.a,null)):null))}var S=a(75);function w(e){var t=Object(o.useState)(!1),a=Object(c.a)(t,2),i=a[0],u=a[1],s=Object(o.useState)({users:[]}),d=Object(c.a)(s,2),f=d[0],m=d[1],b=Object(o.useState)([]),E=Object(c.a)(b,2),v=E[0],O=E[1],j=Object(o.useState)(),k=Object(c.a)(j,2),g=k[0],D=k[1];return Object(o.useEffect)((function(){Object(S.i)().then((function(e){var t=e.data;0===t.code&&O(t.data)}))}),[]),Object(o.useEffect)((function(){D(e.data)}),[e.data]),l.a.createElement(l.a.Fragment,null,l.a.createElement(p,Object.assign({},e,{data:g,onItemEditClick:function(e){u(!0),m(e)}})),l.a.createElement(x,{visible:i,onOk:function(t){t.startDate=t.startDate?t.startDate.format("YYYY-MM-DD"):null,t.endDate=t.endDate?t.endDate.format("YYYY-MM-DD"):null,t.users=v.filter((function(e){return-1!==t.selectedUsers.indexOf(e._id)}));var a=f._id;Object(S.g)(Object(r.a)(Object(r.a)({},f),t)).then((function(t){var n=t.data;if(0===n.code){var r=g.map((function(e){return e._id===a?n.data:e}));e.updateTasks(r),u(!1)}}))},onCancel:function(){u(!1)},task:f,users:[].concat(Object(n.a)(f.users),Object(n.a)(v))}))}},654:function(e,t,a){e.exports={curSprint:"_2usx8r6Dj1MaiK6ZFpLt0-"}},676:function(e,t,a){"use strict";a.r(t);var n=a(2),r=a(7),c=a(31),o=a(0),l=a.n(o),i=a(665),u=a(666),s=a(667),d=a(346),f=a(345),m=a(63),b=a(72),p=a(190),E=a.n(p),v=a(430),O=a(679),j=a(385),k=a(29),g=a(668);function D(e){var t=e.columns,a=e.visible,n=e.onCancel,r=e.onOk,c=Object(k.a)(e,["columns","visible","onCancel","onOk"]);return l.a.createElement(d.a,{forceRender:!0,title:"\u5bfc\u5165\u4efb\u52a1",width:1200,visible:a,okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",onOk:r,onCancel:n},l.a.createElement(g.a,Object.assign({rowKey:function(e){return e._id}},c,{showSelectAll:!1}),(function(e){var a=e.filteredItems,n=e.onItemSelectAll,r=e.onItemSelect,c=e.selectedKeys,o={onSelectAll:function(e,t){var a=t.map((function(e){return e._id}));n(e?a:c,e)},onSelect:function(e,t){var a=e._id;r(a,t)},selectedRowKeys:c};return l.a.createElement(u.a,{pagination:!1,scroll:{y:300},rowSelection:o,rowKey:"_id",columns:t,dataSource:a,size:"small",onRow:function(e){var t=e._id;return{onClick:function(){r(t,!c.includes(t))}}}})})))}var h=a(395),y=a(33),x=a.n(y),S=a(51),w=a(132),C=a(75),I=function(e){return{type:w.a,data:e}},_=a(394),Y=a(654),M=a.n(Y),F=i.a.RangePicker,K=u.a.Column,R=[{dataIndex:"content",title:"\u4efb\u52a1"},{dataIndex:"createDate",title:"\u521b\u5efa\u65f6\u95f4"}],A={createSprint:function(e){return function(){var t=Object(S.a)(x.a.mark((function t(a){var n,r;return x.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,C.b(e);case 2:n=t.sent,0===(r=n.data).code&&a(I(r.data));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},getSprints:function(){return function(){var e=Object(S.a)(x.a.mark((function e(t){var a,n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.m();case 2:a=e.sent,0===(n=a.data).code&&t((r=n.data,{type:w.b,data:r}));case 5:case"end":return e.stop()}var r}),e)})));return function(t){return e.apply(this,arguments)}}()}};t.default=Object(m.b)((function(e){return{project:e.project,sprints:e.sprints}}),A)((function(e){var t=Object(o.useState)(!1),a=Object(c.a)(t,2),i=a[0],m=a[1],p=Object(o.useState)(!1),k=Object(c.a)(p,2),g=k[0],y=k[1],x=Object(o.useState)([]),S=Object(c.a)(x,2),w=S[0],I=S[1],Y=Object(o.useState)([]),A=Object(c.a)(Y,2),T=A[0],N=A[1],U=Object(o.useState)([]),q=Object(c.a)(U,2),z=q[0],L=q[1],P=Object(o.useState)(null),B=Object(c.a)(P,2),G=B[0],J=B[1],Q=Object(o.useRef)(null);Object(o.useEffect)((function(){e.getSprints(),Object(C.m)().then((function(e){var t=e.data;0===t.code&&(t.data.forEach((function(e){var t=e.tasks;e.tasks=Object(_.a)(t)})),N(t.data))})),Object(C.o)().then((function(e){var t=e.data,a=t.data.filter((function(e){return"todo"===e.status}));0===t.code&&L(a)}))}),[]);var V=e.project,Z=V.startDate,W=V.endDate,H=T.length,X=Z;if(H>0){var $=T[H-1].endDate;X=E()($).add(1,"days").format("YYYY-MM-DD")}return l.a.createElement("div",null,l.a.createElement(s.a,{title:"\u9879\u76ee\u9636\u6bb5",extra:l.a.createElement("a",{onClick:function(){m(!0)}},l.a.createElement(v.a,{style:{fontSize:"24px"}}))},l.a.createElement(u.a,{dataSource:T,pagination:!1,rowKey:"_id",rowClassName:function(e){return E()().isBetween(e.startDate,e.endDate,null,"[]")?M.a.curSprint:null},expandable:{expandedRowRender:function(e){var t=Object.values(e.tasks).flat();return l.a.createElement(h.a,{data:t,status:_.b,size:"small",editable:!1})},rowExpandable:function(e){return Object.values(e.tasks).flat().length>0}}},l.a.createElement(K,{title:"\u9636\u6bb5\u5468\u671f",key:"date",render:function(e,t){return"".concat(t.startDate,"~").concat(t.endDate)}}),l.a.createElement(K,{title:"\u4efb\u52a1\u8fdb\u5ea6",dataIndex:"_id",render:function(e,t){return l.a.createElement(b.b,{to:"/project/board/sprint/".concat(e)},l.a.createElement(j.a,{todo:t.tasks.todo.length,doing:t.tasks.doing.length,done:t.tasks.done.length}))}}),l.a.createElement(K,{title:"\u64cd\u4f5c",dataIndex:"_id",render:function(e){return l.a.createElement(l.a.Fragment,null,l.a.createElement("a",{onClick:function(){!function(e){y(!0),I([]),J(e)}(e)}},l.a.createElement(O.a,null)))}}))),l.a.createElement(d.a,{title:"\u65b0\u589e\u9636\u6bb5",width:480,visible:i,onOk:function(e){Q.current.validateFields().then((function(e){var t=e.rangeDate,a=t[0].format("YYYY-MM-DD"),n=t[1].format("YYYY-MM-DD");return Object(C.b)({startDate:a,endDate:n})})).then((function(e){var t=e.data;if(0===t.code){var a=[].concat(Object(r.a)(T),[t.data]);m(!1),N(a),Q.current.resetFields()}})).catch((function(e){console.log("\u9a8c\u8bc1\u5931\u8d25\uff1a",e)}))},onCancel:function(e){m(!1)},okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88"},l.a.createElement(f.a,{ref:Q},l.a.createElement(f.a.Item,{name:"rangeDate",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u9636\u6bb5\u65f6\u95f4\uff01"}]},l.a.createElement(F,{disabledDate:function(e){return!e.isBetween(X,W,"day","[]")},defaultPickerValue:[E()(X)],style:{width:"100%"}})))),l.a.createElement(D,{onCancel:function(e){y(!1)},visible:g,dataSource:z,targetKeys:w,onOk:function(){if(w.length){var e=[],t=[];z.forEach((function(a){w.includes(a._id)?e.push(a):t.push(a)}));var a=T.map((function(t){return t._id===G?Object(n.a)(Object(n.a)({},t),{},{tasks:Object(n.a)(Object(n.a)({},t.tasks),{},{todo:t.tasks.todo.concat(e)})}):t}));N(a),L(t),y(!1)}else y(!1)},onChange:function(e){I(e)},columns:R}))}))}}]);
//# sourceMappingURL=7.361055e1.chunk.js.map